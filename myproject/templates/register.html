<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Registration</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Roboto", sans-serif;
        background: linear-gradient(120deg, #e3f2fd, #f1f8e9);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        overflow: hidden; /* Prevent body scrolling */
      }

      .login-card {
        width: 100%;
        max-width: 400px;
        max-height: 80vh; /* Ensure the card fits within the viewport */
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        background-color: white;
        overflow-y: auto; /* Enable vertical scrolling if content overflows */
      }

      h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #272b34;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.95rem;
        color: #444;
      }

      .form-group input,
      .form-group select {
        width: 95%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 0.95rem;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #4a69bd;
        box-shadow: 0 0 5px rgba(74, 105, 189, 0.5);
      }

      .btn-submit {
        background: linear-gradient(45deg, #272b34, #4a69bd);
        color: white;
        font-weight: bold;
        border: none;
        padding: 10px;
        width: 100%;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s, transform 0.3s;
      }

      .btn-submit:hover {
        background: linear-gradient(45deg, #6a89cc, #272b34);
        transform: scale(1.05);
      }

      .error-message {
        color: red;
        font-size: 0.9rem;
      }

      #studentFields {
        margin-top: 10px;
        /* padding-top: 10px; */
      }

      .role-selection {
        display: flex;
        align-items: center;
        justify-content: space-between; 
      
      }
      
      .role-option {
        display: flex;
        align-items: center;
        gap: 5px; /* Adjust the gap as needed */
      }

      .form-group input[type="radio"] {
        width: 20px;
      }
    </style>

    <script>
      function initializeForm() {
        const roleRadios = document.querySelectorAll('input[name="role"]');
        const studentFields = document.getElementById("studentFields");
        const schoolEmailField = document.getElementById("schoolEmail");
        const emailForm = document.getElementById("emailForm");
        const emailField = document.getElementById("email");

        roleRadios.forEach(radio => {
            radio.addEventListener("change", () => {
                const role = document.querySelector('input[name="role"]:checked').value;

                if (role === "student") {
                    studentFields.style.display = "block";
                    emailForm.style.display = "none";
                    schoolEmailField.required = true;
                    schoolEmailField.setAttribute(
                        "pattern",
                        "^[^@\\s]+@northeastern\\.edu$"
                    );
                    schoolEmailField.setAttribute(
                        "title",
                        "Must be a valid Northeastern University email address."
                    );
                    document.getElementById("nuid").required = true;
                    document.getElementById("householdIncome").required = true;
                    document.getElementById("householdNumber").required = true;

                    emailField.removeAttribute("required");
                    emailField.removeAttribute("pattern"); 
                    emailField.removeAttribute("title");
                    emailField.setAttribute("name", "schoolEmail");
                } else {
                    emailForm.style.display = "block";
                    studentFields.style.display = "none";
                    schoolEmailField.required = false;

                    emailField.setAttribute("required", "true");
                    emailField.setAttribute(
                        "pattern",
                        "^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$"
                    );
                    emailField.setAttribute("title", "Must be a valid email address.");
                    emailField.setAttribute("name", "email");

                    document.getElementById("nuid").required = false;
                    document.getElementById("householdIncome").required = false;
                    document.getElementById("householdNumber").required = false;
                }
            });
        });
      }

      document.addEventListener("DOMContentLoaded", function() {
          initializeForm();
          console.log("registerForm", document.getElementById('registrationForm'));

          document.getElementById('registrationForm').addEventListener('submit', async (e) => {
              e.preventDefault();
              const formData = new FormData(e.target);
              console.log("formData", formData);
              
              try {
                  const response = await fetch('/register/', {
                      method: 'POST',
                      headers: {
                          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                      },
                      body: formData
                  });
                  
                  const data = await response.json();
                  console.log("data", data);

                  if (data.success) {
                      console.log(data.redirect);
                      window.location.href = data.redirect;
                  } else {
                      alert(data.message || 'Registration failed');
                  }
              } catch (error) {
                  console.error('Error:', error);
                  alert('An error occurred during registration');
              }
          });
      });
    </script>
  </head>
  <body>
    <div class="login-card">
      <h2>User Registration</h2>
      <form id="registrationForm" method="POST" action="/register/">
        {% csrf_token %}

        <!-- Name Field -->
        <div class="form-group">
          <label for="name">Name:</label>
          <input type="text" id="name" name="name" required />
        </div>

        <!-- Role Selector -->
        <div class="form-group">
          <label for="role">Role:</label>
          <!-- <select id="role" name="role" required>
            <option value="">Select your role</option>
            <option value="donor">Donor</option>
            <option value="student">Student</option>
            <option value="admin">Admin</option>
          </select> -->

          <div class="role-selection">
              <div class="role-option">
                  <label for="roleDonor">Donor</label>
                  <input type="radio" id="roleDonor" name="role" value="donor" required>
              </div>
              <div class="role-option">
                  <label for="roleStudent">Student</label>
                  <input type="radio" id="roleStudent" name="role" value="student" required>
              </div>
              <div class="role-option">
                  <label for="roleAdmin">Admin</label>
                  <input type="radio" id="roleAdmin" name="role" value="admin" required>
              </div>
          </div>
        </div>

        <!-- Email Field -->
        <div id="emailForm" style="display: block">
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required />
          </div>
        </div>

        <!-- School Email and Student-Specific Fields -->
        <div id="studentFields" style="display: none">
          <div class="form-group">
            <label for="schoolEmail">School Email:</label>
            <input
              type="email"
              id="schoolEmail"
              name="schoolEmail"
              placeholder="example@northeastern.edu"
            />
          </div>

          <div class="form-group">
            <label for="nuid">NUID:</label>
            <input
              type="number"
              id="nuid"
              name="nuid"
              maxlength="10"
              placeholder="Enter your 10-digit NUID"
            />
          </div>

          <div class="form-group">
            <label for="householdIncome">Household Income:</label>
            <input
              type="number"
              id="householdIncome"
              name="householdIncome"
              maxlength="8"
              placeholder="Income in USD"
            />
          </div>

          <div class="form-group">
            <label for="householdNumber">Household Number:</label>
            <input
              type="number"
              id="householdNumber"
              name="householdNumber"
              placeholder="Number of members"
            />
          </div>
        </div>

        <!-- Password Field -->
        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" required />
        </div>

        <!-- Address Field -->
        <div class="form-group">
          <label for="address">Address (optional):</label>
          <input type="text" id="address" name="address" />
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn-submit">Submit</button>
      </form>
    </div>
  </body>
</html>
